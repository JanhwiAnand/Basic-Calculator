package com.example.ems.dto;

import java.time.LocalDate;

public record LeaveResponseDto(
		Long id,
		String firstname,
		String lastname,
		String email,
		LocalDate startDate,
		LocalDate endDate,
		String reason,
		String category,
		String status	
) {}package com.example.ems.entity;

import jakarta.persistence.*;
import lombok.*;

import java.time.LocalDate;
import java.time.LocalDateTime; // Add this import

import com.example.ems.enums.LeaveStatus;
import com.fasterxml.jackson.annotation.JsonBackReference;

@Entity
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
public class LeaveRequest {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne(fetch = FetchType.EAGER)
    @JoinColumn(name = "user_id", nullable = false)
    @JsonBackReference
    private User user;

    private LocalDate startDate;

    private LocalDate endDate;

    private String reason;

    @Enumerated(EnumType.STRING)
    private LeaveStatus status;

    @Column(name = "created_at", nullable = false) // Add this field
    private LocalDateTime createdAt;

    @Column(nullable = false) // Added this field
    private String category;

    @PrePersist // Automatically set createdAt before saving
    protected void onCreate() {
        createdAt = LocalDateTime.now();
    }
}package com.example.ems.entity;

import jakarta.persistence.*;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.List;
import java.time.LocalDate;
import java.util.ArrayList;
import com.example.ems.enums.Role;
import com.fasterxml.jackson.annotation.JsonManagedReference;

// Entity representing a user (employee or admin) in the leave management system
@Entity
@Data
@NoArgsConstructor
public class User {
    // Unique identifier for the user
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    //User's firstname
    @Column(nullable=false)
    private String firstname;
    
    //User's lastname
    @Column(nullable=false)
    private String lastname;
    
    //Phone number
    @Column(nullable=false)
    private String phnno;
    
    //Date of joining
    @Column(nullable=false)
    private LocalDate date_of_joining;
    
    // User's email, acts as username, must be unique and non-null
    @Column(unique = true, nullable = false)
    private String email;

    // User's password, non-null
    @Column(nullable = false)
    private String password;
    
    //User's city
    @Column(nullable=false)
    private String city;
    
    //User's department
    @Column(nullable=false)
    private String department;
    
    //User's country
    @Column(nullable=false)
    private String country;
    
    //User's state
    @Column(nullable=false)
    private String state;
    
    //User's role (EMPLOYEE or ADMIN)
    @Enumerated(EnumType.STRING)
    @Column(nullable = false)
    private Role role;
    
    // One-to-many relationship with leave requests
    @OneToMany(mappedBy = "user", cascade = CascadeType.ALL, orphanRemoval = true)
    @JsonManagedReference //added in parent side to avoid circular loop
    private List<LeaveRequest> leaveRequests=new ArrayList<>();
}
